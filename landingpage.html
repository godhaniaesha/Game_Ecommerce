<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The Unconquered â€“ GameForge</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <link href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" rel="stylesheet" />
    <link rel="stylesheet" href="./css/d_style.css">
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/s_style.css" />
    <link rel="stylesheet" href="./css/z_style.css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
</head>

<body>
    <div class="d_main">
        <!-- Header -->
        <header class="d_header d-flex align-items-center justify-content-between">
            <div class="d_logo">
                <i class="fas fa-dragon"></i> GameForge
            </div>

            <!-- Desktop Nav -->
            <nav class="d_navbar navbar navbar-expand-lg d-none d-lg-flex">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="landingpage.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="allProduct.html">Games</a></li>
                    <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="About_us.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="./Contact_us.html">Contact</a></li>
                </ul>

                <form class="d_search_form ">
                    <input type="search" placeholder="Search games..." />
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>

                <div class="d_social_icons me-3">
                    <a href="./Cart.html"><i class="fa fa-cart-plus"></i></a>
                </div>

                <div class="d_user_icon_wrapper position-relative">
                    <div class="d_user_icon" id="db_user_icon" title="User Profile">
                        <i class="fas fa-user-circle"></i>
                    </div>

                    <div class="d_user_dropdown" id="db_user_dropdown">
                        <ul>
                            <li><a href="./auth/Login.html">Sign in</a></li>
                            <li><a href="./auth/ForgetPass.html">Change Password</a></li>
                            <li><a href="Profile.html">My Profile</a></li>
                            <li><a href="#">Logout</a></li>
                        </ul>
                    </div>
                </div>

            </nav>

            <!-- Mobile Toggler -->
            <button class="d_toggler_btn d-lg-none" aria-label="Menu">
                <i class="fas fa-bars"></i>
            </button>
        </header>

        <!-- Offcanvas Mobile Menu -->
        <aside class="d_offcanvas_menu" id="d_offcanvas_menu">
            <button class="close_btn" aria-label="Close Menu">&times;</button>
            <nav>
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link active" href="landingpage.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="allProduct.html">Games</a></li>
                    <li class="nav-item"><a class="nav-link" href="blog.html">Blog</a></li>
                    <li class="nav-item"><a class="nav-link" href="About_us.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="./Contact_us.html">Contact</a></li>
                </ul>
            </nav>
            <form class="d_search_form_offcanvas">
                <input type="search" placeholder="Search games..." />
                <button type="submit"><i class="fas fa-search"></i></button>
            </form>
            <div class="d_social_icons_offcanvas">
                <a href="./Cart.html"><i class="fa fa-cart-plus"></i></a>
                <a href="Profile.html"><i class="fas fa-user-circle"></i></a>
            </div>
        </aside>
    </div>
    <section class="d_hero-section">
        <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="d_hero-overlay"></div>
                    <div class="d_hero-content-wrapper">
                        <h1 class="d_hero-title">THE UNCONQUERED</h1>
                        <div class="d_hero-divider"></div>
                        <div class="d_hero-subtitle">It seemed to be a sort of monster, or symbol representing a
                            monster,<br /> of a
                            form which only a diseased fancy could conceive.</div>
                        <a href="#" class="d_hero-btn">BUY THEME</a>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d_hero-overlay"></div>
                    <div class="d_hero-content-wrapper">
                        <h1 class="d_hero-title">GAMEFORGE HORROR</h1>
                        <div class="d_hero-divider"></div>
                        <div class="d_hero-subtitle">Beyond time and sanity, the void gazes back.<br /> What will you do
                            when it
                            calls your name?</div>
                        <a href="/About_us.html" class="d_hero-btn">EXPLORE NOW</a>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d_hero-overlay"></div>
                    <div class="d_hero-content-wrapper">
                        <h1 class="d_hero-title">RISE OF THE VOID</h1>
                        <div class="d_hero-divider"></div>
                        <div class="d_hero-subtitle">Whispers in the dark, forgotten tomes, and eternal war.<br /> The
                            rise begins
                            now.</div>
                        <a href="#" class="d_hero-btn">JOIN THE FIGHT</a>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </section>
    <section class="d_category_section">
        <div class="container">
            <h2 class="d_section_title">Explore Game Categories</h2>
            <div class="d_category_scroll_wrapper" id="categoryWrapper"></div>
        </div>
    </section>
    <section class="db_featured_games_section">
        <div class="container">
            <div class="db_section_header">
                <h2 class="db_section_title">Featured Games</h2>
                <a href="/allProduct.html" class="db_view_all_btn">View All</a>
            </div>
            <div class="swiper mySwiper py-4 mt-3">
                <div class="swiper-wrapper" id="swiperCards">
                    <!-- Cards will be injected here by JS -->
                </div>
                <!-- Add navigation buttons
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        Add pagination
        <div class="swiper-pagination"></div> -->
            </div>
        </div>
    </section>

    <!-- Feature Section -->
    <section class="d_feature_section">
        <div class="container">
            <div class="d_feature_wrapper">

                <!-- Image -->
                <div class="d_feature_image">
                    <img src="https://rog.asus.com/media/1620192526692.jpg" alt="Gaming Feature" />
                </div>

                <!-- Content -->
                <div class="d_feature_content">
                    <h2 class="d_feature_title"><i class="fa-solid fa-fire-flame-curved me-2"></i>Seasonal Game Launch
                    </h2>
                    <p class="d_feature_text">
                        Dive into the most anticipated games of the year! From action-packed adventures to immersive
                        RPGs,
                        our new collection delivers next-gen excitement. Get early access, exclusive bonuses, and
                        unmatched discounts now.
                    </p>
                    <button class="d_feature_btn">
                        Explore Now
                    </button>
                </div>

            </div>

        </div>
    </section>

    <!-- comming soon start  -->

    <div class="d_coming_wrapper">
        <section class="d_coming_section">
            <div class="container">
                <h2><i class="fa-solid fa-bolt me2"></i>Upcoming Premium Games</h2>

                <div id="recentProducts" class="d_coming_slider"></div>

            </div>

            <div class="d_slider_nav">
                <button class="d_arrow_btn d_prev_arrow"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="d_arrow_btn d_next_arrow"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
    </div>
    </section>
    </div>


    <!-- Founder & Team Section -->
    <section class="d_founder_section">
        <div class="container">
            <h2 class="d_section_title" data-aos="fade-down">Our Team</h2>
            <p class="d_section_subtitle" data-aos="fade-up">Creative minds behind the game</p>

            <div class="row justify-content-center">
                <!-- Founder -->
                <div class="col-12 col-sm-4 col-lg-3" data-aos="zoom-in" data-aos-delay="100">
                    <div class="d_member_card">
                        <img src="https://i.pinimg.com/736x/d0/cb/d1/d0cbd1380c72ddf3750c896433b2dea1.jpg" alt="Founder"
                            class="d_member_img">
                        <div class="d_member_content">
                            <h4 class="d_member_name">Alex Knight</h4>
                            <p class="d_member_role"><i class="fas fa-gamepad"></i> Founder</p>
                            <div class="d_member_social">
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="#"><i class="fab fa-linkedin"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Member 1 -->
                <div class="col-12 col-sm-4 col-lg-3" data-aos="zoom-in" data-aos-delay="200">
                    <div class="d_member_card">
                        <img src="https://avatars.mds.yandex.net/i?id=b21df524f3cd6e6d72d8c1d12ca23ff54e1b9d56-10503706-images-thumbs&n=13"
                            alt="Dev" class="d_member_img">
                        <div class="d_member_content">
                            <h4 class="d_member_name">Ryan Smith</h4>
                            <p class="d_member_role">Lead Dev</p>
                            <div class="d_member_social">
                                <a href="#"><i class="fab fa-github"></i></a>
                                <a href="#"><i class="fab fa-linkedin"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Member 2 -->
                <div class="col-12 col-sm-4 col-lg-3" data-aos="zoom-in" data-aos-delay="300">
                    <div class="d_member_card">
                        <img src="https://avatars.mds.yandex.net/i?id=3fdf8c2c5a8d0d62d31f6b74a0f22f644943d27d-5257871-images-thumbs&n=13"
                            alt="Designer" class="d_member_img">
                        <div class="d_member_content">
                            <h4 class="d_member_name">Emily Ray</h4>
                            <p class="d_member_role">UI/UX Designer</p>
                            <div class="d_member_social">
                                <a href="#"><i class="fab fa-behance"></i></a>
                                <a href="#"><i class="fab fa-twitter"></i></a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Member 3 -->
                <div class="col-12 col-sm-4 col-lg-3" data-aos="zoom-in" data-aos-delay="400">
                    <div class="d_member_card">
                        <img src="https://avatars.mds.yandex.net/i?id=69733bdc9e798a69a804b7aa5a2845f9999bbe99-5087049-images-thumbs&n=13"
                            alt="QA" class="d_member_img">
                        <div class="d_member_content">
                            <h4 class="d_member_name">Liam Jones</h4>
                            <p class="d_member_role">QA Engineer</p>
                            <div class="d_member_social">
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="#"><i class="fab fa-github"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="d_footer text-white">
        <div class="container py-md-3 ">
            <div class="row gy-4">
                <div class="col-md-4">
                    <h4 class="d_footer-logo mb-3">GAMEFORGE</h4>
                    <p class="d_footer_text">A realm where ancient horrors dwell and forgotten heroes rise again.
                        Unleash your
                        legend in the shadows.</p>
                </div>
                <div class="col-md-2 col-6">
                    <h5 class="text-white mb-3">Quick Links</h5>
                    <ul class="list-unstyled d_footer-links">
                        <li><a href="landingpage.html" class="active">Home</a></li>
                        <li><a href="allProduct.html">Games</a></li>
                        <li><a href="About_us.html">About</a></li>
                        <li><a href="Contact_us.html">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-6">
                    <h5 class="text-white mb-3">Our Policy</h5>
                    <ul class="list-unstyled d_footer-links">
                        <li><a href="landingpage.html" class="active">Home</a></li>
                        <li><a href="Contact_us.html">Blog</a></li>
                        <li><a href="Privacy.html">Privacy</a></li>
                        <li><a href="services.html">Service</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 class="text-white mb-3">Contact</h5>
                    <ul class="list-unstyled d_footer-links d_footer_text">
                        <li><i class="fas fa-envelope me-2"></i> support@gameforge.com</li>
                        <li><i class="fas fa-phone me-2"></i> +91 98765 43210</li>
                        <li><i class="fas fa-location-dot me-2"></i> GameForge HQ, Darkrealm</li>
                    </ul>
                    <div class="d_footer-social mt-3">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-x-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-discord"></i></a>
                    </div>
                </div>
            </div>
            <hr class="border-secondary mt-4" />
            <div class="text-center d_footer_text small">
                &copy; 2025 GAMEFORGE. All rights reserved.
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script>
        // Logout functionality
        document.querySelectorAll('a').forEach(function (link) {
            if (link.textContent.trim().toLowerCase() === 'logout') {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    localStorage.removeItem('user_id');
                    window.location.href = 'landingpage.html';
                });
            }
        });
    </script>
    <script>
        // Show first letter of user email in user icon if logged in
        document.addEventListener('DOMContentLoaded', async function () {
            const userId = localStorage.getItem('user_id');
            const userIconDiv = document.getElementById('db_user_icon');
            if (userId && userIconDiv) {
                try {
                    const res = await fetch(`http://localhost:4000/users/${userId}`);
                    if (res.ok) {
                        const user = await res.json();
                        if (user.email && user.email.length > 0) {
                            userIconDiv.innerHTML = `<span style="font-size:20px;font-weight:200;display:inline-block;width:2.2rem;height:2.2rem;line-height:2.2rem;text-align:center;background:#ad9d79;color:#fff;border-radius:50%;">${user.email[0].toUpperCase()}</span>`;
                        }
                    }
                } catch (e) {
                    // fallback: keep icon
                }
            }
        });
    </script>
    <script>
        (function () {
            const toggler = document.querySelector('.d_toggler_btn');
            const offcanvas = document.getElementById('d_offcanvas_menu');
            const closeBtn = offcanvas.querySelector('.close_btn');

            toggler.addEventListener('click', () => {
                offcanvas.classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            closeBtn.addEventListener('click', () => {
                offcanvas.classList.remove('active');
                document.body.style.overflow = '';
            });

            document.addEventListener('click', (e) => {
                if (!offcanvas.contains(e.target) && !toggler.contains(e.target)) {
                    offcanvas.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    offcanvas.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });

            // Sticky header scroll effect
            window.addEventListener('scroll', () => {
                const header = document.querySelector('.d_header');
                if (window.scrollY > 20) {
                    header.classList.add('d_scrolled');
                } else {
                    header.classList.remove('d_scrolled');
                }
            });
        })();
    </script>
    <script>
        const gameSlider = document.querySelector('.db_game_slider');
        const leftArrow = document.querySelector('.db_left_arrow');
        const rightArrow = document.querySelector('.db_right_arrow');

        let currentCardIndex = 0; // Tracks the index of the first visible card
        const cardWidth = 280; // As defined in .db_game_card min-width/max-width
        const gapWidth = 32; // 2rem = 32px (assuming 1rem = 16px)
        const cardWidthWithGap = cardWidth + gapWidth; // Total space one card occupies

        function updateSliderPosition() {
            const sliderPadding = parseFloat(getComputedStyle(gameSlider).paddingLeft); // Get left padding dynamically
            const totalCards = document.querySelectorAll('.db_game_card').length;
            const visibleWidth = gameSlider.parentElement.offsetWidth; // Use container width, not slider width
            const totalWidth = totalCards * cardWidthWithGap;
            let translateXValue = currentCardIndex * cardWidthWithGap;

            // Calculate the maximum translateX so the last card is flush with the right edge
            const maxTranslateX = Math.max(0, totalWidth - visibleWidth);

            // If we're about to scroll past the end, clamp to maxTranslateX
            if (translateXValue > maxTranslateX) {
                translateXValue = maxTranslateX;
                // Optionally, update currentCardIndex so left arrow works as expected
                currentCardIndex = Math.round(maxTranslateX / cardWidthWithGap);
            }

            gameSlider.style.transform = `translateX(-${translateXValue}px)`;

            // Update arrow visibility
            leftArrow.style.opacity = currentCardIndex === 0 ? '0.5' : '1';
            rightArrow.style.opacity = translateXValue >= maxTranslateX ? '0.5' : '1';
        }

        leftArrow.addEventListener('click', () => {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                updateSliderPosition();
            }
        });

        rightArrow.addEventListener('click', () => {
            const totalCards = document.querySelectorAll('.db_game_card').length;
            const visibleWidth = gameSlider.parentElement.offsetWidth;
            const totalWidth = totalCards * cardWidthWithGap;
            const maxTranslateX = Math.max(0, totalWidth - visibleWidth);

            let nextTranslateX = (currentCardIndex + 1) * cardWidthWithGap;
            if (nextTranslateX > maxTranslateX) {
                currentCardIndex = Math.round(maxTranslateX / cardWidthWithGap);
            } else {
                currentCardIndex++;
            }
            updateSliderPosition();
        });

        // Auto-scroll functionality
        let autoScrollInterval;

        function startAutoScroll() {
            stopAutoScroll(); // Clear any existing interval before starting a new one
            autoScrollInterval = setInterval(() => {
                const sliderPadding = parseFloat(getComputedStyle(gameSlider).paddingLeft);
                const totalCards = document.querySelectorAll('.db_game_card').length;
                const visibleWidth = gameSlider.parentElement.offsetWidth;
                const totalWidth = totalCards * cardWidthWithGap;
                const maxTranslateX = Math.max(0, totalWidth - visibleWidth);

                if (currentCardIndex >= maxTranslateX) {
                    currentCardIndex = 0; // Loop back to the beginning
                } else {
                    currentCardIndex++;
                }
                updateSliderPosition();
            }, 4000);
        }

        function stopAutoScroll() {
            clearInterval(autoScrollInterval);
        }

        // Start auto-scroll
        startAutoScroll();

        // Pause auto-scroll on hover
        const gamesSection = document.querySelector('.db_featured_games_section');
        gamesSection.addEventListener('mouseenter', stopAutoScroll);
        gamesSection.addEventListener('mouseleave', startAutoScroll);

        // Handle window resize
        window.addEventListener('resize', () => {
            // Recalculate everything on resize to ensure correct positioning
            updateSliderPosition();
        });

        // Initialize slider position on load
        window.addEventListener('load', updateSliderPosition);

        // Add click effects to game cards
        document.querySelectorAll('.db_game_card').forEach(card => {
            card.addEventListener('click', function () {
                const title = this.querySelector('.db_game_title').textContent;
                console.log(`Clicked on: ${title}`);
                // Add your game card click logic here
            });
        });

        // Add heart icon toggle functionality
        document.querySelectorAll('.db_game_icons button').forEach(button => {
            button.addEventListener('click', function (e) {
                e.stopPropagation();
                const icon = this.querySelector('i');

                if (icon.classList.contains('fa-heart')) {
                    icon.classList.toggle('fas');
                    icon.classList.toggle('far');
                    this.style.background = icon.classList.contains('fas') ? '#c55978' : 'rgba(255, 255, 255, 0.9)';
                    this.style.color = icon.classList.contains('fas') ? '#fff' : '#18151a';
                }
            });
        });
    </script>

    <script>
        AOS.init({ duration: 800, once: true });
    </script>
    <script>
        const dbUserIcon = document.getElementById('db_user_icon');
        const dbUserDropdown = document.getElementById('db_user_dropdown');

        dbUserIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            dbUserDropdown.style.display = dbUserDropdown.style.display === 'block' ? 'none' : 'block';
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', () => {
            dbUserDropdown.style.display = 'none';
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch("http://localhost:4000/categories")
                .then(res => res.json())
                .then(categories => {
                    const wrapper = document.getElementById("categoryWrapper");
                    wrapper.innerHTML = ""; // Clear any existing content

                    categories.forEach(cat => {
                        // Choose icon based on category name
                        let icon = "";
                        switch (cat.name) {
                            case "Action": icon = "fa-bolt"; break;
                            case "Adventure": icon = "fa-compass"; break;
                            case "Puzzle": icon = "fa-puzzle-piece"; break;
                            case "Racing": icon = "fa-car"; break;
                            case "Shooter": icon = "fa-crosshairs"; break;
                            case "Sports": icon = "fa-futbol"; break;
                            case "Strategy": icon = "fa-chess-knight"; break;
                            case "Horror": icon = "fa-ghost"; break;
                            default: icon = "fa-gamepad";
                        }

                        wrapper.innerHTML += `
                <div class="d_category_card">
                    <img src="${cat.image}" alt="${cat.name} Game" />
                    <div class="d_category_overlay">
                        <div class="d_category_text">${cat.name}</div>
                    </div>
                    <i class="fa-solid ${icon} d_icon_top"></i>
                </div>
                `;
                    });
                })
                .catch(() => {
                    document.getElementById("categoryWrapper").innerHTML = "<div class='text-danger'>Failed to load categories.</div>";
                });
        });
    </script>
    <script>
        async function fetchAndRenderSwiperCards() {
            try {
                // Fetch products and technology data in parallel
                const [productsRes, techRes] = await Promise.all([
                    fetch('http://localhost:4000/products'),
                    fetch('http://localhost:4000/technology')
                ]);
                const [products, technologies] = await Promise.all([
                    productsRes.json(),
                    techRes.json()
                ]);

                // Render cards
                const swiperCards = document.getElementById('swiperCards');
                swiperCards.innerHTML = products.map(card => {
                    // Find technology objects for this product, render as <i> with background image
                    const techIcons = (card.technology_ids || [])
                        .map(id => technologies.find(t => t.id == id))
                        .filter(Boolean)
                        .map(tech => {
                            let iconClass = '';
                            if (tech.name === 'iOS' || tech.name === 'MacOS') iconClass = 'fa-brands fa-apple';
                            else if (tech.name === 'Windows') iconClass = 'fa-brands fa-windows';
                            else if (tech.name === 'Android') iconClass = 'fa-brands fa-android';
                            else if (tech.name === 'Linux') iconClass = 'fa-brands fa-linux';
                            return `<span class="tech-icon-img"><i class="${iconClass}"></i></span>`;
                        }).join(' ')

                    return `
                    <div class="swiper-slide d-flex justify-content-center">
                        <div class="game-card position-relative" data-id="${card.id}">
                            <img src="${card.image}" alt="${card.title}" class="card-img-top" />
                            <div class="position-absolute card-content">
                                <div class="icons d-flex gap-2 mb-3">
                                  ${techIcons}
                                </div>
                                <h3>${card.title}</h3>
                                <h3 class="mb-0">$${card.price}</h3>
                            </div>
                            <div class="card-actions d-flex align-items-center gap-3">
                                <div class="d_main_button w-100">
                                    <button class="custom-cart-btn w-100" data-id="${card.id}">ADD TO CART</button>
                                    <div class="d_border"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');

                // Initialize Swiper after rendering
                new Swiper('.mySwiper', {
                    slidesPerView: 3,
                    spaceBetween: 24,
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                    },
                    loop: true,
                    autoplay: {
                        delay: 3000,
                        disableOnInteraction: false,
                    },
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    },
                    breakpoints: {
                        0: { slidesPerView: 1 },
                        576: { slidesPerView: 2 },
                        768: { slidesPerView: 3 },
                        1024: { slidesPerView: 4 }
                    }
                });

                // Add click handler to each card
                document.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', function () {
                        const id = this.getAttribute('data-id');
                        localStorage.setItem('item_id', id);
                        window.location.href = 'singleProduct.html';
                    });
                });

                // Add click handler for the "ADD TO CART" button
                document.querySelectorAll('.custom-cart-btn').forEach(btn => {
                    btn.addEventListener('click', async function (e) {
                        e.stopPropagation();
                        const pro_id = Number(this.getAttribute('data-id'));
                        localStorage.setItem('cart_id', pro_id);

                        // 1. Get user id from localStorage
                        const user_id = Number(localStorage.getItem('user_id'));
                        if (!user_id) {
                            alert('Please log in to add to cart!');
                            return;
                        }

                        // 2. Check if user already has a cart
                        let cartRes = await fetch(`http://localhost:4000/cart?user_id=${user_id}`);
                        let carts = await cartRes.json();
                        let cart = carts[0];

                        if (cart) {
                            // 3. If cart exists, update products array
                            let products = cart.products || [];
                            let found = false;
                            products = products.map(item => {
                                if (item.pro_id === pro_id) {
                                    found = true;
                                    return { ...item, quantity: item.quantity + 1 };
                                }
                                return item;
                            });
                            if (!found) {
                                products.push({ pro_id, quantity: 1 });
                            }

                            // 4. Update cart in db
                            await fetch(`http://localhost:4000/cart/${cart.id}`, {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ products })
                            });
                        } else {
                            // 5. If no cart, create new cart
                            await fetch('http://localhost:4000/cart', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    user_id,
                                    products: [{ pro_id, quantity: 1 }]
                                })
                            });
                        }

                        alert('Added to cart!');
                    });
                });
            } catch (error) {
                console.error('Error fetching products or technologies:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchAndRenderSwiperCards);
    </script>

    <script>
        // New function to render product cards
        function renderProductCards(products, categories) {
            const catMap = {};
            categories.forEach(cat => { catMap[cat.id] = cat.name; });
            const gridContainer = document.getElementById('gridContainer');
            gridContainer.innerHTML = "";
            products.forEach(product => {
                const categoryName = catMap[product.cat_id] || "Unknown";
                gridContainer.innerHTML += `
                    <div class="col-lg-4 col-md-6 col-sm-6 col-12 mb-4 d-flex justify-content-center">
                      <div class="game-card position-relative">
                        <img src="${product.image}" alt="${product.title}" class="card-img-top" />
                        <div class="position-absolute card-content">
                          <h3>${product.title}</h3>
                          <h3 class="mb-0">$${Number(product.price).toFixed(2)}</h3>
                          <span class="badge bg-secondary mt-2">${categoryName}</span>
                        </div>
                      </div>
                    </div>
                `;
            });
        }

        // Fetch and render products on page load
        document.addEventListener("DOMContentLoaded", function () {
            Promise.all([
                fetch("http://localhost:4000/products").then(res => res.json()),
                fetch("http://localhost:4000/categories").then(res => res.json())
            ]).then(([products, categories]) => {
                renderProductCards(products, categories);
            });
        });
    </script>
    <script>
        async function renderLastFourProducts() {
            try {
                const res = await fetch('http://localhost:4000/products');
                let products = await res.json();

                // Reverse and get last 4
                const lastFour = products.reverse().slice(0, 4);

                // Render cards in .d_coming_card format
                const container = document.getElementById('recentProducts');
                container.innerHTML = lastFour.map(product => `
                    <div class="d_coming_card" data-date="2025-12-20T00:00:00" data-id="${product.id}" style="cursor: pointer;">
                        <div class="d_coming_card_img">
                            <span class="d_release_tag">Dec 20, 2025</span>
                            <img src="${product.image}" alt="${product.title}">
                        </div>
                        <div class="d_coming_card_body">
                            <div class="d_coming_card_title">${product.title}</div>
                            <div class="d_coming_card_meta">$${Number(product.price).toFixed(2)}</div>
                            <div class="d_coming_countdown">
                                <div><span class="days">00</span><small>Days</small></div>
                                <div><span class="hours">00</span><small>Hrs</small></div>
                                <div><span class="minutes">00</span><small>Min</small></div>
                                <div><span class="seconds">00</span><small>Sec</small></div>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Add click event listeners to upcoming game cards
                document.querySelectorAll('.d_coming_card').forEach(card => {
                    card.addEventListener('click', function() {
                        const productId = this.getAttribute('data-id');
                        localStorage.setItem('item_id', productId);
                        window.location.href = 'singleProduct.html';
                    });
                });

                // Re-initialize Slick slider
                $('#recentProducts').slick('unslick'); // destroy if already initialized
                $('#recentProducts').slick({
                    slidesToShow: 3,
                    arrows: true,
                    prevArrow: $('.d_prev_arrow'),
                    nextArrow: $('.d_next_arrow'),
                    responsive: [
                        { breakpoint: 992, settings: { slidesToShow: 2 } },
                        { breakpoint: 768, settings: { slidesToShow: 1 } }
                    ]
                });
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', renderLastFourProducts);
    </script>
    <script>
        $('.d_coming_slider').slick({
            slidesToShow: 2,
            arrows: true,
            prevArrow: $('.d_prev_arrow'),
            nextArrow: $('.d_next_arrow'),
            responsive: [
                { breakpoint: 992, settings: { slidesToShow: 2 } },
                { breakpoint: 768, settings: { slidesToShow: 1 } }
            ]
        });

        function updateCountdown(card, targetDate) {
            const now = new Date().getTime();
            const diff = new Date(targetDate).getTime() - now;
            if (diff < 0) return;

            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            card.querySelector('.days').innerText = d;
            card.querySelector('.hours').innerText = h;
            card.querySelector('.minutes').innerText = m;
            card.querySelector('.seconds').innerText = s;
        }

        setInterval(() => {
            document.querySelectorAll('.d_coming_card').forEach(card => {
                const date = card.getAttribute('data-date');
                updateCountdown(card, date);
            });
        }, 1000);
    </script>
    <!-- Swiper JS -->
</body>

</html>